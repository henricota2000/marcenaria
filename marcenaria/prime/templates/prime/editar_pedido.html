<!-- filepath: c:\Users\robso\Desktop\teste\marcenaria\Marcenaria\prime\templates\prime\pedido_sucesso.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Pedido</title>

<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 15px 0;
            text-align: center;
        }
        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
        }
        nav ul li {
            margin: 0 20px;
        }
        nav ul li a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }
        main {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #444;
        }
        .search-box {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        .search-box label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .search-box input {
            width: calc(100% - 100px);
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-box button {
            width: 90px;
            padding: 8px;
            background-color: #444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group input[type="number"] {
            text-align: right;
        }
        .form-group input[readonly] {
            background-color: #f0f0f0;
        }
        .item-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: flex-end;
        }
        .item-row .form-group {
            flex: 1;
            min-width: 0;
        }
        .item-row .form-group:first-child {
            flex: 0.5;
        }
        .item-row .form-group:nth-child(5) {
            width: 180px; /* Largura fixa para os campos Total dos itens */
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button[type="submit"] {
            background-color: #28a745;
            color: white;
        }
        button.edit-button {
            background-color: #007bff;
            color: white;
        }
        button.print-button {
            background-color: #6c757d;
            color: white;
        }
        h2 {
            margin: 25px 0 15px;
            color: #444;
            font-size: 18px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .financial-section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        /* Estilos para os campos financeiros alinhados */
        .financial-row {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        .financial-label {
            width: 120px;
            padding: 8px 10px 0 0;
            text-align: right;
            font-weight: bold;
            font-size: 14px;
        }
        .financial-input {
            width: 180px; /* Mesma largura dos campos Total dos itens */
        }
        .financial-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            text-align: right;
        }
        .financial-input input[readonly] {
            background-color: #f0f0f0;
        }
        .financial-total {
            border-top: 1px solid #ddd;
            padding-top: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>


    <main>
        <h1>Editar Pedidos</h1>
    
        <form method="post">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label for="nomeCliente">Nome Cliente:</label>
                    <input type="text" id="nomeCliente" name="nomeCliente" value="{{ pedido.cliente.nome }}" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="dataInicio">Data Início:</label>
                    <input type="date" id="dataInicio" name="dataInicio" value="{{ pedido.data_pedido|date:'Y-m-d' }}">
                </div>
                <div class="form-group">
                    <label for="dataEntrega">Data Entrega:</label>
                    <input type="date" id="dataEntrega" name="dataEntrega" value="{{ pedido.data_entrega|date:'Y-m-d' }}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="telefone">Telefone:</label>
                    <input type="text" id="telefone" name="telefone" value="{{ pedido.cliente.telefone1 }}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="cepEntrega">CEP Entrega:</label>
                    <input type="text" id="cepEntrega" name="cepEntrega" value="{{ pedido.cliente.cep }}">
                </div>
                <div class="form-group">
                    <label for="enderecoEntrega">Endereço Entrega:</label>
                    <input type="text" id="enderecoEntrega" name="enderecoEntrega" value="{{ pedido.cliente.endereco }}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="numeroEntrega">Número:</label>
                    <input type="text" id="numeroEntrega" name="numeroEntrega" value="{{ pedido.cliente.numero }}">
                </div>
                <div class="form-group">
                    <label for="complementoEntrega">Complemento:</label>
                    <input type="text" id="complementoEntrega" name="complementoEntrega" value="{{ pedido.cliente.complemento }}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="cidadeEntrega">Cidade:</label>
                    <input type="text" id="cidadeEntrega" name="cidadeEntrega" value="{{ pedido.cliente.cidade }}">
                </div>
                <div class="form-group">
                    <label for="estadoEntrega">Estado:</label>
                    <input type="text" id="estadoEntrega" name="estadoEntrega" value="{{ pedido.cliente.estado }}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="formaPagamento">Forma de Pagamento:</label>
                    <select id="formaPagamento" name="formaPagamento" required>
                        <option value="pix" {% if pedido.forma_pagamento == 'pix' %}selected{% endif %}>Pix</option>
                        <option value="dinheiro" {% if pedido.forma_pagamento == 'dinheiro' %}selected{% endif %}>Dinheiro</option>
                        <option value="debito" {% if pedido.forma_pagamento == 'debito' %}selected{% endif %}>Cartão de Débito</option>
                        <option value="credito" {% if pedido.forma_pagamento == 'credito' %}selected{% endif %}>Cartão de Crédito</option>
                    </select>
                </div>
            </div>

            <div class="financial-section">
                <div class="financial-row">
                    <div class="financial-label">Subtotal:</div>
                    <div class="financial-input">
                        <input type="number" step="0.01" name="subtotal" value="{{ pedido.subtotal|default:0 }}" readonly>
                    </div>
                </div>
                <div class="financial-row">
                    <div class="financial-label">Acréscimo:</div>
                    <div class="financial-input">
                        <input type="number" step="0.01" name="acrescimo" value="{{ pedido.acrescimo|default:0 }}">
                    </div>
                </div>
                <div class="financial-row">
                    <div class="financial-label">Desconto:</div>
                    <div class="financial-input">
                        <input type="number" step="0.01" name="desconto" value="{{ pedido.desconto|default:0 }}">
                    </div>
                </div>
                <div class="financial-row">
                    <div class="financial-label financial-total">Total:</div>
                    <div class="financial-input">
                        <input type="number" step="0.01" name="valorTotal" value="{{ pedido.valor_total|default:0 }}" readonly>
                    </div>
                </div>
                <div class="financial-row">
                    <div class="financial-label">Valor Parcela:</div>
                    <div class="financial-input">
                        <input type="number" step="0.01" name="valorParcela" value="{{ pedido.valor_parcela|default:0 }}" readonly>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="obsGeral">OBS Geral:</label>
                    <textarea id="obsGeral" name="obsGeral" rows="3">{{ pedido.descricao }}</textarea>
                </div>
            </div>

            <button type="submit">Salvar Alterações</button>
        </form>
            
    </main>
    

    <script>
        // Função para calcular o subtotal com base nos itens
        function calcularSubtotal() {
            let subtotal = 0;

            // Itera sobre os itens do pedido
            for (let i = 1; i <= 5; i++) {
                const quantidade = parseFloat(document.querySelector(`select[name="quantidadeItem${i}"]`).value) || 0;
                const valorUnitario = parseFloat(document.querySelector(`input[name="valorUnitarioItem${i}"]`).value) || 0;
                const totalItem = quantidade * valorUnitario;

                // Atualiza o campo de total do item
                document.querySelector(`input[name="totalItem${i}"]`).value = totalItem.toFixed(2);

                // Soma ao subtotal
                subtotal += totalItem;
            }

            // Atualiza o subtotal
            document.querySelector('input[name="subtotal"]').value = subtotal.toFixed(2);

            // Calcula o total com acréscimo e desconto
            calcularTotal();
        }

        // Função para calcular o total com acréscimo e desconto
        function calcularTotal() {
            const subtotal = parseFloat(document.querySelector('input[name="subtotal"]').value) || 0;
            const acrescimo = parseFloat(document.querySelector('input[name="acrescimo"]').value) || 0;
            const desconto = parseFloat(document.querySelector('input[name="desconto"]').value) || 0;

            // Calcula o total
            const total = subtotal + acrescimo - desconto;

            // Atualiza o campo de total
            document.querySelector('input[name="valorTotal"]').value = total.toFixed(2);

            // Atualiza o valor das parcelas
            calcularParcelas();
        }

        // Função para calcular o valor das parcelas
        function calcularParcelas() {
            const total = parseFloat(document.querySelector('input[name="valorTotal"]').value) || 0;
            const parcelas = parseInt(document.querySelector('select[name="parcelas"]').value) || 1;
            const valorParcela = total / parcelas;

            // Atualiza o campo de valor da parcela
            document.querySelector('input[name="valorParcela"]').value = valorParcela.toFixed(2);
        }

        // Adiciona eventos para recalcular os valores ao alterar os campos
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof calcularSubtotal === 'function') {
                calcularSubtotal();
            }
        });
    </script>
</body>
</html>
