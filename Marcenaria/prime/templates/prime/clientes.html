{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes</title>
    <link rel="stylesheet" href="{% static 'styles/style.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css" media="all"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700|Lato:400,700,400italic,700italic" type="text/css" media="screen"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Red+Hat+Display:ital,wght@0,300..900;1,300..900&display=swap" type="text/css" media="screen"/>
    <link rel="stylesheet" href="style.css" type="text/css" media="screen"/>
    <script>
      window.onload = function () {
        const campos = document.querySelectorAll(
          '#codigoCliente, #nome, #cpf, #rg, #dataNascimento, #cep, #endereco, #numero, #complemento, #cidade, #estado, #telefone1, #telefone2, #email, #historicoPedidos'
        );
        campos.forEach(campo => campo.disabled = true);
      };
    </script>
<style>
/* Reset básico */

*{
     margin: 0;
    padding: 0;
    box-sizing: border-box;
      font-family:  Arial, sans-serif;
      
}
input[type="text"] {
      font-family: sans-serif; /* Tipo de fonte */
      font-size: 16px;                  /* Tamanho da fonte */
      color: #333;                      /* Cor do texto */
      padding: 8px;
      width: 300px;
    }

body {
             min-height: 100vh; /* garante altura mínima da tela */
             background: linear-gradient(to bottom, #c5cce4, #eaebec);
             background-repeat: no-repeat;
              background-attachment: fixed; /* mantém o fundo fixo ao rolar */
             background-size: 100% 100%; /* estica o gradiente para cobrir toda a altura */
            background-position: top;
}

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
        }
        nav ul li {
            margin: 0 20px;
        }
        nav ul li a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }
        main {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #444;
            font-family: 'times new roman', 'Arial', sans-serif;
}

.search-box {
    margin-bottom: 20px;
}

.search-box label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.search-box input {
    width: calc(100% - 100px);
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.search-box button {
    width: 90px;
    padding: 10px;
    background-color: #333;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.search-box button:hover {
    background-color: #555;
}
/*Espaçamento dos dados de cliente*/
        .form-group.codigocliente { flex: 0.9; }     
        .form-group.nome{ flex: 4; }   
        .form-group.cpf { flex: 1.3; } 
        .form-group.rg { flex: 1; } 
        .form-group.datanasc{ flex: 1; }   
 
/*Espaçamento dos dados de cliente*/
        .form-group.cep{ flex: 1; }     
        .form-group.endereco{ flex: 4; }   
        .form-group.numero { flex: 0.8; } 
        .form-group.complemento { flex: 1; } 
        .form-group.cidade{ flex: 1; }   
        .form-group.estado{ flex: 0.5; }   

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.form-group {
    flex: 1;
}

.form-group.full-width {
    flex: 0 0 100%;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input[type="text"],
.form-group input[type="date"],
.form-group input[type="email"],
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.form-group input[readonly] {
    background-color: #f0f0f0;
    cursor: not-allowed;
}

.form-group input[type="checkbox"] {
    margin-right: 10px;
}

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button[type="submit"] {
            background-color: #28a745;
            color: white;
        }
         button.cancelar{
            background-color: #e44545;
            color: white;
        }
                
         button.novo{
            background-color: #0516b4;
            color: #ffffff;
        }
        button.edit-button {
            background-color: #007bff;
            color: white;
        }
        button.print-button {
            background-color: #6c757d;
            color: white;
        }

@media (max-width: 768px) {
    .form-row {
        flex-direction: column; /* Alinha os campos verticalmente em telas menores */
    }

    .search-box input {
        width: 100%; /* Ajusta o campo de busca para ocupar toda a largura */
    }

    .button-group {
        flex-direction: column; /* Alinha os botões verticalmente */
    }
}
/*impressão*/
@media print {
    @page {
        size: A4;
        margin: 15mm;
    }
    

    * {
        font-size: 10px !important;
        line-height: 1.2 !important;
    }


    /* Oculta botões e menus */
    header, nav, .button-group {
        display: none !important;
    }

    /* Remove contorno de inputs e selects */
    input, select, textarea {
        border: none !important;
        outline: none !important;
        box-shadow: none !important;
        background: transparent !important;
        appearance: none;
        -webkit-appearance: none;
        font-size: 10px !important;
        line-height: 1.2 !important;
    }

    /* Estilo "folha limpa" */
    main {
        box-shadow: none !important;
        border: 1px solid #000;
        padding: 10px !important;
        background: #fff !important;
        font-size: 10px !important;
        line-height: 1.2 !important;
    }

    /* Reduz espaçamento entre grupos de formulário */
    .form-group {
        margin-bottom: 4px !important;
        padding: 2px !important;
        font-size: 10px !important;
        line-height: 1.2 !important;
    }

    /* Rodapé com data e nome */
    body::after {
        content: "Impresso em: " attr(data-date);
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        text-align: center;
        font-size: 10px;
        border-top: 1px solid #000;
        padding: 5px;
    }
    
input, select, textarea {
    display: inline-block !important;
    width: auto !important;
    vertical-align: middle !important;
}

    .form-row {
        display: flex !important;
        flex-direction: row !important;
        gap: 20px !important;
        margin-bottom: 8px !important;
    }
    .form-group {
        flex: 1 !important;
    }
    /* Não defina width: 100% nos inputs! */
}
/* ===== Tema Claro (padrão) ===== */
body.claro {
               background: linear-gradient(to bottom, #c5cce4, #eaebec);
             background-repeat: no-repeat;
              background-attachment: fixed; /* mantém o fundo fixo ao rolar */
             background-size: 100% 100%; /* estica o gradiente para cobrir toda a altura */
            background-position: top;
}
 
body.claro main {
  background-color: #fff;
  color: #222;
}

body.escuro {

            background: linear-gradient(to bottom, #3a3a3a, #616161);
             background-repeat: no-repeat;
              background-attachment: fixed; /* mantém o fundo fixo ao rolar */
             background-size: 100% 100%; /* estica o gradiente para cobrir toda a altura */
            background-position: top;
}
 
body.escuro main {
  background-color: #3a3a3a;
  color: #f0f0f0;

}
 
body.escuro input,
body.escuro select,
body.escuro textarea {
  background-color: #555;
  color: #fff;
  border: 1px solid #888;
}
 
body.escuro .search-box {
  background-color: #555;
}
body.claro .financial-section {
  background-color: #e9e9e9; /* cinza claro no modo claro */
  color: #222; /* texto escuro */
}
 
 
/* Botão escuro */
.botao-escuro {
  background-color: #333;
  color: white;
  border: none;
  padding: 10px 15px;
  cursor: pointer;
}
 
/* Botão claro */
.botao-claro {
  background-color: #eee;
  color: black;
  border: none;
  padding: 10px 15px;
  cursor: pointer;
}

body.escuro .financial-section {
  background-color: #4e4b4b; /* cinza escuro no modo escuro */
  color: #f0f0f0; /* texto claro */
}

body.claro h1 {
  color: #555; /* cinza no modo claro */
}
  
body.escuro h1 {
  color: #fff; /* branco no modo escuro */
}
body.escuro h2 {
  color: #fff; /* branco no modo escuro */
}
body.escuro #campovalor {
  background-color: #444141; /* cinza escuro */
  color: #fff;            /* texto claro */
  border: 1px solid #888;
}
body.escuro #codigopedido {
  background-color: #444141; /* cinza escuro */
  color: #fff;            /* texto claro */
  border: 1px solid #888;
}
body.escuro input[readonly]#codigoCliente {
    background-color: #444141 !important;
    color: #fff !important;
    border: 1px solid #888 !important;
}
</style>
</head>
<body class="home sticky-menu sidebar-off claro" id="top">
<header class="header">
    <div class="header-wrap">
        <div class="logo plain logo-left">
            <div class="logo">
                <a href="{% url 'home' %}">
                    <img width="100" height="100" src="{% static 'image/logo-nunes.png' %}" class="Marcenaria nunes" alt="Logo da Marcenaria Nunes"/>
                </a>
            </div>
        </div>
        <nav id="nav" role="navigation">
            <div class="table">
                <div class="table-cell">
                    <ul id="menu-menu-1">
                        <li class="menu-item"><a href="{% url 'clientes' %}">Novo Cliente</a></li>
                        <li class="menu-item"><a href="{% url 'pedidos' %}">Novo pedido</a></li>
                        <li class="menu-item"><a href="{% url 'lista_clientes' %}">Buscar cliente</a></li>
                        <li class="menu-item"><a href="{% url 'lista_pedidos' %}">Buscar Pedido</a></li>
                        <li class="menu-item">
                            <button type="button" onclick="zoomIn()">Zoom +</button>
                            <button type="button" onclick="zoomOut()">Zoom -</button>
                        </li>
                        <li class="menu-item">
                            <button type="button" id="botaoModo" onclick="modoclaroescuro()">🌙 Modo Escuro</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</header>
<main>
    <h1>Cadastro de Clientes</h1>
    {% if error %}
    <div class="error-message">
        <p style="color: red;">{{ error }}</p>
    </div>
    {% endif %}
    <form action="{% url 'clientes' %}" method="post">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group codigocliente">
                <label for="codigoCliente">Código Cliente:</label>
                <input type="text" id="codigoCliente" name="codigoCliente" readonly>
            </div>
            <div class="form-group nome">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" required>
            </div>
            <div class="form-group cpf">
                <label for="cpf">CPF/CNPJ:</label>
                <input type="text" id="cpf" maxlength='18' placeholder="CPF ou CNPJ" name="cpf" required>
                <span id="erro" style="color: red; font-size: 0.9em;"></span>
            </div>
            <div class="form-group rg">
                <label for="rg">RG:</label>
                <input type="text" id="rg" name="rg" maxlength="12" placeholder="00.000.000-0">
            </div>
            <div class="form-group datanasc">
                <label for="dataNascimento">Data de Nascimento:</label>
                <input type="date" id="dataNascimento" name="dataNascimento">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group cep">
                <label for="cep">CEP:</label>
                <input type="text" id="cep" name="cep">
            </div>
            <div class="form-group endereco">
                <label for="endereco">Endereço:</label>
                <input type="text" id="endereco" name="endereco" required>
            </div>
            <div class="form-group numero">
                <label for="numero">Número:</label>
                <input type="text" id="numero" name="numero" required>
            </div>
            <div class="form-group complemento">
                <label for="complemento">Complemento:</label>
                <input type="text" id="complemento" name="complemento">
            </div>
            <div class="form-group cidade">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" name="cidade" required>
            </div>
            <div class="form-group estado">
                <label for="estado">Estado:</label>
                <input type="text" id="estado" name="estado" required>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group tel1">
                <label for="telefone1">Telefone 1:</label>
                <input type="text" id="telefone1" name="telefone1" required>
            </div>
            <div class="form-group tel2">
                <label for="telefone2">Telefone 2:</label>
                <input type="text" id="telefone2" name="telefone2">
            </div>
            <div class="form-group email">
                <label for="email">E-mail:</label>
                <input type="email" id="email" name="email" required>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group full-width">
                <label for="historicoPedidos">Histórico de Pedidos:</label>
                <textarea id="historicoPedidos" name="historicoPedidos"></textarea>
            </div>
        </div>
        <div class="button-group">
            <button type="button" class="novo" onclick="desbloquearCampos()">Novo/Editar</button>
            <button type="submit">Salvar Cliente</button>
            <button type="button" class="cancelar" onclick="cancelar()">Cancelar</button>
            <button type="button" onclick="imprimirVersaoLimpa()">Imprimir</button>
        </div>
    </form>
</main>
<script>
function imprimirVersaoLimpa() {
    const body = document.body;
    const hoje = new Date().toLocaleDateString("pt-BR");
    body.setAttribute("data-date", hoje);
    window.print();
}
function desbloquearCampos() {
    const campos = document.querySelectorAll(
        '#codigoCliente, #nome, #cpf, #rg, #dataNascimento, #cep, #endereco, #numero, #complemento, #cidade, #estado, #telefone1, #telefone2, #email, #historicoPedidos'
    );
    campos.forEach(campo => campo.disabled = false);

    // Reaplica as máscaras/listeners após habilitar
    aplicarMascaraECep();
    aplicarMascaraCpfCnpj();
}
function cancelar() {
    const campos = document.querySelectorAll(
        '#codigoCliente, #nome, #cpf, #rg, #dataNascimento, #cep, #endereco, #numero, #complemento, #cidade, #estado, #telefone1, #telefone2, #email, #historicoPedidos'
    );
    campos.forEach(campo => campo.disabled = true);
}
let scale = 1;
function zoomIn() {
    if (scale < 1.5) {
        scale += 0.1;
        document.body.style.transform = `scale(${scale})`;
        document.body.style.transformOrigin = 'top left';
    }
}
function zoomOut() {
    if (scale > 0.5) {
        scale -= 0.1;
        document.body.style.transform = `scale(${scale})`;
        document.body.style.transformOrigin = 'top left';
    }
}
function modoclaroescuro() {
    const body = document.body;
    const botao = document.getElementById("botaoModo");
    if (body.classList.contains("escuro")) {
        body.classList.remove("escuro");
        body.classList.add("claro");
        botao.textContent = "🌙 Modo Escuro";
        botao.classList.remove("botao-claro");
        botao.classList.add("botao-escuro");
    } else {
        body.classList.remove("claro");
        body.classList.add("escuro");
        botao.textContent = "☀️ Modo Claro";
        botao.classList.remove("botao-escuro");
        botao.classList.add("botao-claro");
    }
}
window.addEventListener("DOMContentLoaded", () => {
    document.body.classList.add("claro");
    const botao = document.getElementById("botaoModo");
    if (botao) {
        botao.textContent = "🌙 Modo Escuro";
        botao.classList.add("botao-escuro");
    }
});

// Máscara e validação para CPF/CNPJ
function aplicarMascaraCpfCnpj() {
    const input = document.getElementById('cpf');
    const erro = document.getElementById('erro');
    if (input) {
        input.addEventListener('input', () => {
            let valor = input.value.replace(/\D/g, '');
            if (valor.length <= 11) {
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else {
                valor = valor.replace(/^(\d{2})(\d)/, '$1.$2');
                valor = valor.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                valor = valor.replace(/\.(\d{3})(\d)/, '.$1/$2');
                valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
            }
            input.value = valor;

            if (valor.length === 14 && !validaCPF(valor)) {
                erro.textContent = "CPF inválido";
            } else if (valor.length === 18 && !validaCNPJ(valor)) {
                erro.textContent = "CNPJ inválido";
            } else {
                erro.textContent = "";
            }
        });
    }
}

function validaCPF(cpfv) {
    cpfv = cpfv.replace(/\D/g, '');
    if (cpfv.length !== 11 || /^(\d)\1+$/.test(cpfv)) return false;
    let soma = 0;
    for (let i = 0; i < 9; i++) soma += parseInt(cpfv.charAt(i)) * (10 - i);
    let dig1 = (soma * 10) % 11;
    if (dig1 === 10) dig1 = 0;
    if (dig1 !== parseInt(cpfv.charAt(9))) return false;
    soma = 0;
    for (let i = 0; i < 10; i++) soma += parseInt(cpfv.charAt(i)) * (11 - i);
    let dig2 = (soma * 10) % 11;
    if (dig2 === 10) dig2 = 0;
    if (dig2 !== parseInt(cpfv.charAt(10))) return false;
    return true;
}

function validaCNPJ(cnpj) {
    cnpj = cnpj.replace(/\D/g, '');
    if (cnpj.length !== 14 || /^(\d)\1+$/.test(cnpj)) return false;
    let tamanho = cnpj.length - 2;
    let numeros = cnpj.substring(0, tamanho);
    let digitos = cnpj.substring(tamanho);
    let soma = 0;
    let pos = tamanho - 7;
    for (let i = tamanho; i >= 1; i--) {
        soma += parseInt(numeros.charAt(tamanho - i)) * pos--;
        if (pos < 2) pos = 9;
    }
    let resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);
    if (resultado !== parseInt(digitos.charAt(0))) return false;
    tamanho = tamanho + 1;
    numeros = cnpj.substring(0, tamanho);
    soma = 0;
    pos = tamanho - 7;
    for (let i = tamanho; i >= 1; i--) {
        soma += parseInt(numeros.charAt(tamanho - i)) * pos--;
        if (pos < 2) pos = 9;
    }
    resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);
    if (resultado !== parseInt(digitos.charAt(1))) return false;
    return true;
}

// Máscara para CEP e busca automática de endereço
function aplicarMascaraECep() {
    const cepInput = document.getElementById('cep');
    if (cepInput) {
        cepInput.addEventListener('input', function (e) {
            let cep = e.target.value.replace(/\D/g, '');
            if (cep.length > 5) {
                cep = cep.replace(/^(\d{5})(\d{0,3})/, '$1-$2');
            }
            e.target.value = cep;
            if (cep.replace(/\D/g, '').length === 8) {
                buscarEndereco(cep.replace(/\D/g, ''));
            }
        });
    }
}

function buscarEndereco(cep) {
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => response.json())
        .then(data => {
            if (data.erro) {
                alert('CEP não encontrado!');
                return;
            }
            document.getElementById('endereco').value = data.logradouro || '';
            document.getElementById('cidade').value = data.localidade || '';
            document.getElementById('estado').value = data.uf || '';
        })
        .catch(() => alert('Erro ao buscar CEP!'));
}

// Chame as funções ao carregar a página
window.addEventListener("DOMContentLoaded", () => {
    aplicarMascaraECep();
    aplicarMascaraCpfCnpj();
});
</script>
</body>
</html>
``` 